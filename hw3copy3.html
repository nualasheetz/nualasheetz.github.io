<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="D3 homework">
<title>D3 Homework</title>
<!--      <script src="https://d3js.org/d3.v5.min.js"></script> -->
           <script src="d3.min.js"></script>


<style>
#chart rect{
  fill: #4aaeea;
}

#chart text{
  fill: white;
  font: 10px sans-serif;
  text-anchor: end; 
}

.axis text{
  font: 10px sans-serif;
}

.axis path, .axis line{
  fill: none;
  stroke : #fff;
  shape-rendering: crispEdges;
}

body{
  background: #1a1a1a;
  color : #eaeaea;
  padding : 10px;
}
</style>
</head>
<body>
<div id="chart"></div> 
</body>


<script>
    
    //set variables for height and width of the SVG container, the chart
    var mySvg = d3.select("#chart").append("svg")
      //grab an element that may not yet exist from the DOM
      .append("g")  //put all the bars into a group
      .attr("width", 500)
      .attr("height", 500);

    var w = mySvg.attr("width") - margin;
	var h = mySvg.attr("height") - margin;
    var margin = 200;
    var x = d3.scaleBand().range([0, w]).padding(0.4);
	var y = d3.scaleLinear().range([h, 0]);

    mySvg.append('text') //title
        .attr('transform', 'translate(100, 0)') //position it
        .attr('x', 50)
        .attr('y', 50)
        .attr('class', 'title')
        .text('Students from spring 2016 to call 2018')

    var x = d3.scaleBand().range([0, w]).padding(0.4);
    var y = d3.scaleLinear().range([h, 0]);

    
    var g = mySvg.append("g") //make group to hold all svg pieces
    //place the axis
    .attr("transform", "translate(" + 100 + "," + 100 + ")")
    .call(d3.axisBottom(x));

   d3.json("hw3data.json")
        .then( function (data) {  //.then somehow deals with errors? something to do with promises?
        x.domain(data.map(function(d) { return d.term; }));
		y.domain([0, d3.max(data, function(d) { return d.students; })]);
		   
    
      //make rectangles for bars
      g.append('g')
        .attr('transfor', 'translate(0, ' + h + ')')
        .call(d3.axisBottom(x)) //add information to the bottom axis
        .append('text')
        .attr('y', h - 250)
        .attr('x', w - 100)
        .attr("text-anchor", "end")
		   .attr("font-size", "1.5em")
		   .attr("stroke", "red")
		   .attr("fill", "red")
		   .text("term");

        g.append("g")
		   .append("text")
		   .attr("transform", "rotate(-90)")
		   .attr("y", 5)
		   .attr("x", -100)
		   .attr("dy", "-2em")
		   .attr("text-anchor", "end")
		   .attr("font-size", "1.5em")
		   .attr("stroke", "red")
		   .attr("fill", "red")
		   .text("students");
        
        g.append("g")
		   .attr("transform", "translate(0, 0)")
		   .call(d3.axisLeft(y)) //add information the left axis
        
           g.selectAll(".bar") //select a not yet existing class bar
		   .data(data)
		   .enter()
		   .append("rect")
		   .attr("class", "bar") // add class bar
		   .on("mouseover", onMouseOver) //call function to do something when the mouse is moved over the area
		   .on("mouseout", onMouseOut)
		   .attr("x", function(d) { return x(d.year); })
		   .attr("y", function(d) { return y(d.population); })
		   .attr("width", x.bandwidth()).transition().ease(d3.easeLinear).duration(200).delay(function(d, i) { return i * 25; })
		   .attr("height", function(d) { return h - y(d.population); });
        });  // end of d3.json

         function onMouseOver(d, i) { //what to do when the mosuse is moved
		    d3.select(this)
			.attr('class', 'over');
            d3.select(this)
			   .transition()
			   .duration(200)
			   .attr('width', x.bandwidth() + 5)
			   .attr("y", function(d) { return y(d.students) - 10; })
			   .attr("height", function(d) { return h - y(d.students) + 10; });

		   }  // end of function onMouseOver

           function onMouseOut(d, i) {
			   d3.select(this)
			      .attr('class', 'bar');
				  
			   d3.select(this)
			      .transition()
				  .duration(200)
				  .attr('width', x.bandwidth())
				  .attr("y", function(d) { return y(d.students); })
				  .attr("height", function(d) {return h - y(d.students); });
				  
				}  // end of onMouseOut
            </script>
   </body>


  </html>
